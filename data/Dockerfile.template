FROM resin/%%RESIN_MACHINE_NAME%%-alpine-node

WORKDIR /usr/src/app

COPY package.json package.json
RUN git clone https://github.com/rupnikj/nodeimu && \
  cd nodeimu && \
  git clone https://github.com/jeff-loughlin/RTIMULib2.git && \
  npm rm nan node-gyp && npm i nan node-gyp && \
  npm install && \
  cd .. && rm -rf nodeimu

RUN apk add --no-cache --virtual .gyp \
        python \
        make \
        g++ \
    && npm install --production --unsafe-perm \
    && apk del .gyp

COPY . ./

CMD ["npm", "start"]
